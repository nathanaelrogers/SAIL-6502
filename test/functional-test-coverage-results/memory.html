<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>memory</title></head>
<body>
<h1>memory.sail (6/6) 100%</h1>
<code style="display: block">
register&nbsp;main_mem&nbsp;:&nbsp;mem_64KB&nbsp;=&nbsp;vector_init(256,&nbsp;vector_init(256,&nbsp;undefined))<br>
<br>
val&nbsp;read&nbsp;:&nbsp;address&nbsp;-&gt;&nbsp;word<br>
function&nbsp;read(addr)&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;page_index&nbsp;=&nbsp;unsigned(addr[15..8]);<br>
&nbsp;&nbsp;&nbsp;&nbsp;word_index&nbsp;=&nbsp;unsigned(addr[7..0]);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;main_mem[page_index][word_index];<br>
}</span><br>
<br>
val&nbsp;write&nbsp;:&nbsp;(address,&nbsp;word)&nbsp;-&gt;&nbsp;unit<br>
function&nbsp;write(addr,&nbsp;data)&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;page_index&nbsp;=&nbsp;unsigned(addr[15..8]);<br>
&nbsp;&nbsp;&nbsp;&nbsp;word_index&nbsp;=&nbsp;unsigned(addr[7..0]);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;main_mem[page_index][word_index]&nbsp;=&nbsp;data<br>
}</span><br>
<br>
val&nbsp;read_zp&nbsp;:&nbsp;word&nbsp;-&gt;&nbsp;word<br>
function&nbsp;read_zp(addr)&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;read(0x00&nbsp;@&nbsp;addr);<br>
}</span><br>
<br>
val&nbsp;write_zp&nbsp;:&nbsp;(word,&nbsp;word)&nbsp;-&gt;&nbsp;unit<br>
function&nbsp;write_zp(addr,&nbsp;data)&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;write(0x00&nbsp;@&nbsp;addr,&nbsp;data);<br>
}</span><br>
<br>
val&nbsp;push&nbsp;:&nbsp;word&nbsp;-&gt;&nbsp;unit<br>
function&nbsp;push(data)&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;write(0x01&nbsp;@&nbsp;reg_SP,&nbsp;data);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(unsigned(reg_SP)&nbsp;&gt;=&nbsp;0)&nbsp;then&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;incr_sp(-1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reg_SP&nbsp;=&nbsp;0xFF<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
}</span><br>
<br>
val&nbsp;pull&nbsp;:&nbsp;unit&nbsp;-&gt;&nbsp;word<br>
function&nbsp;pull()&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(unsigned(reg_SP)&nbsp;&lt;=&nbsp;255)&nbsp;then&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;incr_sp(1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reg_SP&nbsp;=&nbsp;0x00<br>
&nbsp;&nbsp;&nbsp;&nbsp;};<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;read(0x01&nbsp;@&nbsp;reg_SP);<br>
}</span><br>
</code>
</body>
</html>
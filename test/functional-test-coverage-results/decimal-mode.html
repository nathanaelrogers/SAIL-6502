<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>decimal-mode</title></head>
<body>
<h1>decimal-mode.sail (31/33) 94%</h1>
<code style="display: block">
val&nbsp;nibble_to_int&nbsp;:&nbsp;bits(4)&nbsp;-&gt;&nbsp;int<br>
function&nbsp;nibble_to_int(nibble)&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">match&nbsp;nibble&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x0&nbsp;=&gt;&nbsp;0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x1&nbsp;=&gt;&nbsp;1,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x2&nbsp;=&gt;&nbsp;2,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x3&nbsp;=&gt;&nbsp;3,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x4&nbsp;=&gt;&nbsp;4,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x5&nbsp;=&gt;&nbsp;5,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x6&nbsp;=&gt;&nbsp;6,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x7&nbsp;=&gt;&nbsp;7,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x8&nbsp;=&gt;&nbsp;8,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x9&nbsp;=&gt;&nbsp;9,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_&nbsp;&nbsp;&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 70%)">undefined</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
}</span><br>
<br>
val&nbsp;int_to_nibble&nbsp;:&nbsp;int&nbsp;-&gt;&nbsp;bits(4)<br>
function&nbsp;int_to_nibble(n)&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">match&nbsp;n&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 70%)">0x0</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 70%)">0x1</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 70%)">0x2</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 70%)">0x3</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 70%)">0x4</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 70%)">0x5</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 70%)">0x6</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 70%)">0x7</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 70%)">0x8</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 70%)">0x9</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">undefined</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
}</span><br>
<br>
val&nbsp;word_to_decimal&nbsp;:&nbsp;word&nbsp;-&gt;&nbsp;int<br>
function&nbsp;word_to_decimal(word)&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;(nibble_to_int(word[7..4])&nbsp;*&nbsp;10)&nbsp;+&nbsp;nibble_to_int(word[3..0])<br>
}</span><br>
<br>
/*<br>
&nbsp;&nbsp;&nbsp;&nbsp;NOTE:<br>
&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;will&nbsp;never&nbsp;capture&nbsp;the&nbsp;&quot;carry&quot;&nbsp;in&nbsp;a&nbsp;decimal&nbsp;number,&nbsp;but&nbsp;this&nbsp;is<br>
&nbsp;&nbsp;&nbsp;&nbsp;not&nbsp;an&nbsp;issue&nbsp;because&nbsp;BCD&nbsp;mode&nbsp;instructions&nbsp;use&nbsp;the&nbsp;integer&nbsp;value&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;addition/subtraction&nbsp;in&nbsp;logic&nbsp;for&nbsp;setting/clearing&nbsp;the&nbsp;carry.&nbsp;This<br>
&nbsp;&nbsp;&nbsp;&nbsp;method&nbsp;simply&nbsp;preserves&nbsp;the&nbsp;lower&nbsp;8&nbsp;bits&nbsp;worth&nbsp;of&nbsp;information&nbsp;to&nbsp;store<br>
&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;the&nbsp;accumulator<br>
*/<br>
val&nbsp;decimal_to_word&nbsp;:&nbsp;int&nbsp;-&gt;&nbsp;word<br>
function&nbsp;decimal_to_word(op)&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;n&nbsp;:&nbsp;int&nbsp;=&nbsp;op&nbsp;%&nbsp;100;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">if&nbsp;(n&nbsp;&gt;=&nbsp;0)&nbsp;then&nbsp;<span style="background-color: hsl(120, 85%, 70%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int_to_nibble(n&nbsp;/&nbsp;10)&nbsp;@&nbsp;int_to_nibble(n&nbsp;%&nbsp;10)<br>
&nbsp;&nbsp;&nbsp;&nbsp;}</span>&nbsp;else&nbsp;<span style="background-color: hsl(0, 85%, 80%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int_to_nibble((100&nbsp;-&nbsp;n)&nbsp;/&nbsp;10)&nbsp;@&nbsp;int_to_nibble((100&nbsp;-&nbsp;n)&nbsp;%&nbsp;10)<br>
&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>;<br>
}</span><br>
<br>
val&nbsp;decimal_add&nbsp;:&nbsp;(word,&nbsp;word)&nbsp;-&gt;&nbsp;int<br>
function&nbsp;decimal_add(op1,&nbsp;op2)&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;word_to_decimal(op1)&nbsp;+&nbsp;word_to_decimal(op2)<br>
}</span><br>
<br>
val&nbsp;decimal_sub&nbsp;:&nbsp;(word,&nbsp;word)&nbsp;-&gt;&nbsp;int<br>
function&nbsp;decimal_sub(op1,&nbsp;op2)&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;word_to_decimal(op1)&nbsp;-&nbsp;word_to_decimal(op2)<br>
}</span><br>
</code>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>BRK</title></head>
<body>
<h1>BRK.sail (1/1) 100%</h1>
<code style="display: block">
//&nbsp;TODO&nbsp;:&nbsp;BRK&nbsp;should&nbsp;evaluate&nbsp;to&nbsp;true&nbsp;to&nbsp;allow&nbsp;for&nbsp;software&nbsp;interrupt&nbsp;handling,&nbsp;but&nbsp;the&nbsp;BRK&nbsp;opcode&nbsp;is&nbsp;null&nbsp;byte&nbsp;and&nbsp;this&nbsp;is&nbsp;what&nbsp;memory&nbsp;is&nbsp;filled&nbsp;with...<br>
<br>
function&nbsp;clause&nbsp;execute(BRK())&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;incr_cycles(7);<br>
&nbsp;&nbsp;&nbsp;&nbsp;/*<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;By&nbsp;the&nbsp;time&nbsp;this&nbsp;is&nbsp;executed,&nbsp;reg_PC&nbsp;=&nbsp;instruction&nbsp;PC&nbsp;+&nbsp;1&nbsp;(size&nbsp;of&nbsp;BRK&nbsp;instruction).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;So&nbsp;to&nbsp;preserve&nbsp;instruction&nbsp;PC&nbsp;+&nbsp;2,&nbsp;calculate&nbsp;reg_PC&nbsp;+&nbsp;1.<br>
&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;stored_pc&nbsp;=&nbsp;reg_PC&nbsp;+&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;push(stored_pc[15..8]);<br>
&nbsp;&nbsp;&nbsp;&nbsp;push(stored_pc[7..0]);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;reg_SR[X]&nbsp;=&nbsp;0b1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;reg_SR[b]&nbsp;=&nbsp;0b1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;stored_sr&nbsp;=&nbsp;reg_SR[all];<br>
&nbsp;&nbsp;&nbsp;&nbsp;push(stored_sr);<br>
&nbsp;&nbsp;&nbsp;&nbsp;reg_SR[X]&nbsp;=&nbsp;0b0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;reg_SR[b]&nbsp;=&nbsp;0b0;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;reg_SR[i]&nbsp;=&nbsp;0b1;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;PCH&nbsp;=&nbsp;read(IRQ_vec&nbsp;+&nbsp;1);<br>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;PCL&nbsp;=&nbsp;read(IRQ_vec);<br>
&nbsp;&nbsp;&nbsp;&nbsp;reg_PC&nbsp;=&nbsp;PCH&nbsp;@&nbsp;PCL;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;true<br>
}</span><br>
</code>
</body>
</html>